proxy_pass_request_headers on;

# Handle authentication errors specifically
location @handle_auth_error {
    # This will only be called for auth_request 401s
    # Internal redirect to the auth subdomain
    rewrite ^.*$ /google/login break;
    proxy_pass http://auth-backend;
    proxy_set_header X-Original-Path $original_path;
    proxy_set_header X-Original-URI $original_uri;
    proxy_set_header X-Original-Host $original_host;
    proxy_set_header X-Original-Method $original_method;
    proxy_set_header X-Original-Scheme $original_scheme;
    proxy_set_header Host auth.nickhenley.dev;
}
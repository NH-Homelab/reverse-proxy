listen       443 ssl;
ssl_certificate     /etc/nginx/ssl/tls.crt;
ssl_certificate_key /etc/nginx/ssl/tls.key;

# Handle authentication errors specifically
location @handle_auth_error {
    # This will only be called for auth_request 401s
    # Internal redirect to the auth subdomain
    proxy_pass https://auth.nicholashenley.com/google/login;
    proxy_set_header X-Original-Path $original_path;
    proxy_set_header X-Original-URI $original_uri;
    proxy_set_header X-Original-Host $original_host;
    proxy_set_header X-Original-Method $original_method;
    proxy_set_header X-Original-Scheme $original_scheme;
    proxy_set_header Host auth.nicholashenley.com;
}